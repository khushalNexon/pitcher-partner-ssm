import{r as u,u as y,j as e,B as w,P as m,a as T,S as B,T as E,I as A,b as S,W as q}from"./index-189ad134.js";import{F as D,C as p,T as x,u as F,a as k}from"./index.esm-fa80a447.js";import{a as f,D as $}from"./DataGrid-d3a715dd.js";import{T as P,c as I}from"./modal-d92f9407.js";import{B as N}from"./Button-bbb0ac73.js";import{C as O}from"./Container-b09bd05a.js";const Z=async({payload:r})=>{try{return(await f.post("/client/createclient?code=QmJRCuciMZgSckGPDsq1DisKqO38pFYBdoTlBDg6Tz0sAzFuy0GZZw==",r)).data}catch(a){throw Error(a.message||"Something went wrong")}},v=async()=>{try{return(await f.get("/client/getclients?code=QmJRCuciMZgSckGPDsq1DisKqO38pFYBdoTlBDg6Tz0sAzFuy0GZZw==")).data.result}catch(r){throw console.error("Error fetching data:",r),Error(r.message??"Error fetching data")}},G=()=>{const[r,a]=u.useState([]),[d,i]=u.useState(!0),[c,n]=u.useState(null),{openSnackbar:t}=y(),h=async()=>{try{i(!0);const s=await v();a(s)}catch(s){n(s.message||"An error occurred")}finally{i(!1)}};return u.useEffect(()=>{h()},[]),{clients:r,loading:d,error:c,createClient:async({payload:s})=>{console.log(s,r,"this is payload....");try{i(!0);const l=await Z({payload:s}),g=[...r,{id:`client_${s.ClientABNNo}`,employees:[],ClientName:s.ClientName,ClientEmail:s.ClientEmail,ClientABNNo:s.ClientABNNo}];return a(g),t(l.result,"success"),l.result}catch(l){return n(l.message||"An error occurred"),t(l.message,"error"),l.message||"An error occurred"}finally{i(!1)}}}},M=G,b=({methods:r,isOpen:a,handleToggle:d,onSubmit:i,loading:c})=>c?e.jsx("h2",{children:"Loading..."}):e.jsxs(P,{isOpen:a,handleToggle:d,children:[e.jsx("h3",{id:"transition-modal-title",className:"modal-title",children:"Create New Client"}),e.jsx(D,{...r,children:e.jsxs(w,{component:"form",onSubmit:r.handleSubmit(i),sx:{display:"flex",flexDirection:"column",gap:2,width:"100%",margin:"auto"},children:[e.jsx(p,{name:"ClientABNNo",control:r.control,rules:{required:"ClientABNNo is required"},render:({field:n,fieldState:t})=>e.jsx(x,{...n,label:"ClientABNNo",variant:"outlined",error:!!t.error,helperText:t.error?t.error.message:""})}),e.jsx(p,{name:"ClientName",control:r.control,rules:{required:"ClientName is required"},render:({field:n,fieldState:t})=>e.jsx(x,{...n,label:"ClientName",variant:"outlined",error:!!t.error,helperText:t.error?t.error.message:""})}),e.jsx(p,{name:"ClientEmail",control:r.control,rules:{required:"ClientEmail is required"},render:({field:n,fieldState:t})=>e.jsx(x,{...n,type:"email",label:"ClientEmail",variant:"outlined",error:!!t.error,helperText:t.error?t.error.message:""})}),e.jsx(N,{type:"submit",variant:"contained",color:"primary",children:"Submit"})]})})]});b.propTypes={methods:m.object,isOpen:m.bool,handleToggle:m.func,onSubmit:m.func,loading:m.bool};const z=b;function R(){const{clients:r,loading:a,createClient:d}=M(),i=T(),c=F(),[n,t]=u.useState(!1),h=(o,C)=>{i(`/client/${o.id}`)},j=o=>{t(!n)},s=o=>{d({payload:o}).then(()=>t(!n)).catch(C=>C)},l=()=>{t(!n)},g=r==null?void 0:r.map((o,C)=>({id:`${o.id}_${C}`,clientId:o.id,abnNo:o.ClientABNNo,name:o.ClientName,email:o.ClientEmail??"",...o}));return u.useEffect(()=>{n||c.reset()},[n]),e.jsxs(O,{children:[e.jsxs(B,{direction:"row",alignItems:"center",justifyContent:"space-between",mb:5,children:[e.jsx(E,{variant:"h4",children:"Clients"}),e.jsx(N,{variant:"contained",color:"inherit",startIcon:e.jsx(A,{icon:"eva:plus-fill"}),onClick:j,children:"New Clients"})]}),e.jsx(k,{children:e.jsx(S,{children:e.jsx($,{checkboxSelection:!1,data:r,columns:I,rows:g,loading:a,handleOnCellClick:h})})}),e.jsx(z,{methods:c,isOpen:n,handleToggle:l,onSubmit:s,loading:a})]})}function U(){return e.jsxs(e.Fragment,{children:[e.jsx(q,{children:e.jsx("title",{children:" Client "})}),e.jsx(R,{})]})}export{U as default};
